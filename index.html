<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> × ×™×”×•×œ ××©×™××•×ª ×¨××œ×™ ××˜×•"×¡- ××•×¨×™× </title>
<style>
:root {
    --primary: #10b981; 
    --accent: #3b82f6;
    --purple: #8b5cf6;
    --edit: #f59e0b;
    --danger: #ef4444;
    --glass-bg: rgba(255, 255, 255, 0.1);
    --glass-border: rgba(255, 255, 255, 0.2);
}

/* ×¨×§×¢ × ×•×–×œ×™ ×“×™× ××™ ××œ× */
body {
    font-family: 'Segoe UI', system-ui, sans-serif;
    margin: 0;
    padding: 20px;
    direction: rtl;
    min-height: 100vh;
    color: white;
    overflow-x: hidden;
    background: linear-gradient(125deg, #064e3b, #1e3a8a, #4c1d95, #064e3b);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
}

@keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.card {
    background: var(--glass-bg);
    padding: 30px;
    border-radius: 28px;
    max-width: 800px;
    margin: 40px auto;
    backdrop-filter: blur(25px);
    -webkit-backdrop-filter: blur(25px);
    border: 1px solid var(--glass-border);
    box-shadow: 0 25px 50px rgba(0,0,0,0.3);
}

h2, h3, h4 { margin-top: 0; text-shadow: 0 2px 10px rgba(0,0,0,0.2); }

input {
    width: 100%;
    padding: 14px;
    margin: 10px 0;
    border-radius: 15px;
    border: 1px solid var(--glass-border);
    background: rgba(0,0,0,0.2);
    color: white;
    font-size: 16px;
    box-sizing: border-box;
    transition: 0.3s;
    outline: none;
}

input:focus {
    border-color: var(--primary);
    background: rgba(0,0,0,0.3);
}

button {
    background: linear-gradient(135deg, var(--primary), var(--accent));
    color: white;
    border: none;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
    border-radius: 15px;
    padding: 14px;
    font-size: 16px;
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(16,185,129,0.4);
}

.add-class-form {
    background: rgba(255, 255, 255, 0.05);
    padding: 20px;
    border-radius: 22px;
    margin-bottom: 30px;
    border: 1px dashed var(--glass-border);
}

.class-box {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    padding: 20px;
    border-radius: 22px;
    margin-top: 30px;
    animation: fadeIn 0.5s ease-out;
}

.task-item {
    background: rgba(255, 255, 255, 0.07);
    border: 1px solid var(--glass-border);
    padding: 18px;
    margin: 15px 0;
    border-radius: 18px;
}

/* ×’×œ×¨×™×™×ª ×“×¤×™ ×¢×‘×•×“×” */
.ws-teacher-section {
    margin-top: 15px;
    padding: 15px;
    background: rgba(16, 185, 129, 0.15);
    border-radius: 18px;
    border: 1px solid var(--primary);
}

.ws-teacher-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.ws-teacher-images {
    display: flex;
    gap: 12px;
    overflow-x: auto;
    padding-bottom: 8px;
}

.ws-teacher-images img {
    height: 140px;
    border-radius: 10px;
    cursor: pointer;
    border: 2px solid var(--glass-border);
    transition: 0.3s;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.delete-btn-red {
    background: var(--danger);
    padding: 8px 15px;
    font-size: 13px;
    border-radius: 10px;
}
</style>
</head>
<body>

<div class="card">
    <div id="loginArea">
        <h2> âœ¨ ×›× ×™×¡×” ×œ××¢×¨×›×ª ×”××•×¨×™× </h2>
        <input type="text" id="teacherUser" placeholder="×©× ××©×ª××©">
        <input type="password" id="teacherPass" placeholder="×¡×™×¡××”">
        <button onclick="login()" style="width: 100%;">×”×ª×—×‘×¨×•×ª ×œ××¢×¨×›×ª</button>
    </div>

    <div id="dashboard" style="display:none;">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
            <h3 style="margin:0;">×©×œ×•×, <span id="displayName" style="color: var(--primary);"></span> âœ¨</h3>
            <button onclick="logout()" style="background:var(--danger); padding:8px 18px; font-size:14px; border-radius: 12px;">×™×¦×™××”</button>
        </div>

        <div class="add-class-form">
            <h4 style="margin-bottom: 10px;">â• ×”×•×¡×¤×ª ×›×™×ª×” ×—×“×©×”</h4>
            <input type="text" id="newClassName" placeholder="×©× ×”×›×™×ª×” (×œ××©×œ: ×–'8)">
            <input type="text" id="newClassCode" placeholder="×§×•×“ ×›×™×ª×” (×œ××©×œ: RALI78)">
            <button onclick="addNewClass()" style="width: 100%; background: var(--purple);">×¦×•×¨ ×›×™×ª×” ×—×“×©×”</button>
        </div>
        
        <div id="classesList">×˜×•×¢×Ÿ × ×ª×•× ×™×...</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, query, where, onSnapshot, doc, deleteDoc, updateDoc, getDocs, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDvnS8L9r2LMKcUD78Ix7bldVp9qzbYwtk",
        authDomain: "tast-7808e.firebaseapp.com",
        projectId: "tast-7808e",
        storageBucket: "tast-7808e.firebasestorage.app",
        messagingSenderId: "99024860024",
        appId: "1:99024860024:web:24ab70c10254a2014fce8d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ×¤×•× ×§×¦×™×™×ª ×”×ª×—×‘×¨×•×ª ××œ××”
    window.login = (u, p) => {
        const user = u || document.getElementById('teacherUser').value.trim();
        const pass = p || document.getElementById('teacherPass').value.trim();
        if(!user || !pass) return;
        
        localStorage.setItem('teacherUser', user);
        localStorage.setItem('teacherPass', pass);
        
        document.getElementById('loginArea').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        document.getElementById('displayName').innerText = user;
        
        loadClasses(user, pass);
    };

    // ×”×•×¡×¤×ª ×›×™×ª×” ×—×“×©×” ×œ-Firebase
    window.addNewClass = async () => {
        const name = document.getElementById('newClassName').value.trim();
        const code = document.getElementById('newClassCode').value.trim().toUpperCase();
        const user = localStorage.getItem('teacherUser');
        const pass = localStorage.getItem('teacherPass');

        if(!name || !code) return alert("×× × ××œ× ××ª ×›×œ ×”×©×“×•×ª");

        try {
            await setDoc(doc(db, "classes", code), {
                name: name,
                code: code,
                teacherId: user + "_" + pass
            });
            alert("×”×›×™×ª×” " + name + " × ×•×¡×¤×” ×‘×”×¦×œ×—×”!");
            document.getElementById('newClassName').value = '';
            document.getElementById('newClassCode').value = '';
        } catch (e) { alert("×©×’×™××” ×‘×™×¦×™×¨×ª ×›×™×ª×”: " + e.message); }
    };

    function loadClasses(user, pass) {
        const teacherKey = user + "_" + pass;
        onSnapshot(query(collection(db, "classes"), where("teacherId", "==", teacherKey)), (snap) => {
            const list = document.getElementById('classesList');
            list.innerHTML = '';
            snap.forEach(cDoc => {
                const c = cDoc.data();
                const classDiv = document.createElement('div');
                classDiv.className = 'class-box';
                classDiv.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">
                        <strong>ğŸ« ×›×™×ª×”: ${c.name} | ×§×•×“: ${c.code}</strong>
                        <button onclick="deleteClass('${c.code}')" style="background:var(--danger); padding:5px 10px; font-size:11px; border-radius:8px;">××—×§ ×›×™×ª×”</button>
                    </div>
                    <div id="tasks_${c.code}">×˜×•×¢×Ÿ ××©×™××•×ª...</div>
                `;
                list.appendChild(classDiv);
                syncTasks(c.code);
            });
        });
    }

    function syncTasks(code) {
        onSnapshot(query(collection(db, "tasks"), where("classCode", "==", code)), (snap) => {
            const container = document.getElementById(`tasks_${code}`);
            if(!container) return;
            container.innerHTML = '';
            snap.forEach(tDoc => {
                const t = tDoc.data();
                let wsHTML = "";
                if(t.worksheets && t.worksheets.length > 0) {
                    wsHTML = `
                        <div class="ws-teacher-section">
                            <div class="ws-teacher-header">
                                <span style="font-size:12px; font-weight:bold;">ğŸ“„ ×“×¤×™ ×¢×‘×•×“×” ×:${t.worksheetBy}</span>
                                <button onclick="deleteWS('${tDoc.id}')" style="background:red; color:white; border:none; padding:3px 8px; border-radius:5px; font-size:10px; cursor:pointer;">××—×§ ×“×¤×™×</button>
                            </div>
                            <div class="ws-teacher-images">
                                ${t.worksheets.map(img => `<img src="${img}" onclick="window.open(this.src)">`).join('')}
                            </div>
                        </div>`;
                }
                container.innerHTML += `
                    <div class="task-item">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <b>${t.title}</b>
                            <button class="delete-btn-red" onclick="deleteEntireTask('${tDoc.id}', '${code}')">ğŸ—‘ï¸ ××—×§ ××©×™××”</button>
                        </div>
                        ${t.imageUrl ? `<img src="${t.imageUrl}" style="max-width:100%; border-radius:10px; margin-top:10px;">` : ''}
                        ${wsHTML}
                    </div>`;
            });
        });
    }

    window.deleteWS = async (id) => {
        if(confirm("×œ××—×•×§ ××ª ×“×¤×™ ×”×¢×‘×•×“×”?")) {
            await updateDoc(doc(db, "tasks", id), { worksheets: null, worksheetBy: null });
        }
    };

    // ××™××•×ª ×¡×™×¡××” ××•×œ ×¤×™×™×¨×‘×™×™×¡ ×‘×–××Ÿ ×××ª
    window.deleteEntireTask = async (taskId, classCode) => {
        const userInput = prompt("×”×›× ×¡ ×¡×™×¡××ª ××•×¨×” ×œ××™×©×•×¨ ××—×™×§×”:");
        if (!userInput) return;

        const q = query(collection(db, "classes"), where("code", "==", classCode));
        const classSnap = await getDocs(q);
        if(!classSnap.empty) {
            const actualPass = classSnap.docs[0].data().teacherId.split('_')[1];
            if(userInput === actualPass) {
                await deleteDoc(doc(db, "tasks", taskId));
                alert("×”××©×™××” × ××—×§×”.");
            } else { alert("×¡×™×¡××” ×©×’×•×™×”!"); }
        }
    };

    window.deleteClass = async (code) => {
        if(confirm("×œ××—×•×§ ××ª ×›×œ ×”×›×™×ª×” ×•×›×œ ×”×ª×•×›×Ÿ ×©×œ×”?")) {
            await deleteDoc(doc(db, "classes", code));
        }
    };

    window.logout = () => { localStorage.clear(); location.reload(); };
    window.onload = () => {
        const u = localStorage.getItem('teacherUser');
        const p = localStorage.getItem('teacherPass');
        if(u && p) login(u, p);
    };
</script>
</body>
</html>
